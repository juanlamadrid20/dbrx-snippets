# This is a Databricks asset bundle definition for dbrx-snippets.
# The Databricks extension requires databricks.yml configuration file.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.

# This file configures the Databricks Asset Bundle for deployment
bundle:
  name: dbrx-snippets

targets:
  dev:
    default: true
    resources:
      pipelines:
        medallion_dlt_pipeline:
          name: "benchmark_pipeline"
          development: true
          serverless: true
          catalog: "juan_dev"
          schema: "data_eng"
          continuous: false
          libraries:
            - file:
                path: de/pipeline_main.py
          # clusters:
          #   - label: default
          #     autoscale:
          #       min_workers: 2
          #       max_workers: 3
        


      jobs:
        e2e_pipeline_job:
          name: "benchmark_job"
          description: |
            my benchmark job
          tasks:
            - task_key: generate_data_job
              notebook_task:
                notebook_path: de/data_gen_job.py
              # job_cluster_key: job_cluster
            - task_key: process_medallion_pipeline
              depends_on:
                - task_key: generate_data_job
              pipeline_task:
                pipeline_id: ${resources.pipelines.medallion_dlt_pipeline.id}
                full_refresh: false
          tags:
            juan-jobs: benchmark-job
          queue:
            enabled: true
          budget_policy_id: e8def73b-0eea-428b-b1ff-92a9985e1686
          performance_target: PERFORMANCE_OPTIMIZED

    workspace:
      host: https://e2-demo-field-eng.cloud.databricks.com
